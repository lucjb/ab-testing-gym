ul class="list-disc pl-4">
                                                    <li>Daily Traffic</li>
                                                    <li>Base Conversion Rate</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>                            </div></li>

                            <!-- Sample Size Section -->
                            <li class="border rounded-lgp-3 hover:bg-gray-50 transition-colors cursor-pointer" onclick="toggleSection('sample-details')">
                                <div class="flex items-start">                                    <svg class="h-5 w-5 text-green-500 mr-2flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <div class="flex-growpr-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-semibold text-gray-900 text-smSample Size</span>
                                            <svg class="h-4 w-4 transform transition-transform" id="sample-arrow">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </div>
                                        <p class="text-xs mt-1">Check required sample size</p>
                                        <div id="sample-details" class="hidden mt-2 bg-gray-100 rounded p-2">
                                            <div class="space-y-2 text-xs">
                                                <ul class="list-disc pl-4">
                                                    <li>Meet minimum visitors per variant</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>

                            <!-- Business Cycles Section -->
                            <li class="border rounded-lg p-3 hover:bg-gray-50 transition-colors cursor-pointer" onclick="toggleSection('cycles-details')">
                                <div class="flex items-start">
                                    <svg class="h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <div class="flex-grow pr-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-semibold text-gray-900 text-sm">Business Cycles</span>
                                            <svg class="h-4 w-4 transform transition-transform" id="cycles-arrow">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </div>
                                        <p class="text-xs mt-1">Check cycle completion</p>
                                        <div id="cycles-details" class="hidden mt-2 bg-gray-100 rounded p-2">
                                            <div class="space-y-2 text-xs">
                                                <ul class="list-disc pl-4">
                                                    <li>At least 7 days</li>
                                                    <li>Full business cycles</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <script>
            let score = 0;
            let streak = 0;
            let totalAttempts = 0;
            let challenge = null;
            let trustDecision = null;
            let implementDecision = null;
            let currentExperiment = 1;
            const EXPERIMENTS_PER_SESSION = 3;  // Easy to modify for future changes (e.g., 10 or 15)

            // UI Controller Functions
            function updateExecutionSection(experimentData) {
                const currentDate = new Date();
                const daysElapsed = experimentData.simulation.timeline.currentRuntimeDays;
                const totalDays = experimentData.experiment.requiredRuntimeDays;
                const daysRemaining = totalDays - daysElapsed;
                const isComplete = daysElapsed >= totalDays;

                // Calculate dates
                const startDate = new Date(currentDate);
                startDate.setDate(startDate.getDate() - daysElapsed);

                const finishDate = new Date(currentDate);
                finishDate.setDate(finishDate.getDate() + daysRemaining);

                // Format dates
                const dateFormatter = new Intl.DateTimeFormat('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                // Update progress bar and annotations
                const progressPercent = Math.round((daysElapsed / totalDays) * 100);
                const progressBar = document.getElementById('exp-progress-bar');
                const daysElapsedText = document.getElementById('exp-days-elapsed-text');
                const daysRemainingText = document.getElementById('exp-days-remaining-text');
                const completeText = document.getElementById('exp-complete-text');
                const progressStartDate = document.getElementById('progress-start-date');
                const progressEndDate = document.getElementById('progress-end-date');

                progressBar.style.width = `${Math.min(100, progressPercent)}%`;

                if (isComplete) {
                    daysElapsedText.classList.add('hidden');
                    daysRemainingText.classList.add('hidden');
                    completeText.classList.remove('hidden');
                } else {
                    daysElapsedText.classList.remove('hidden');
                    daysRemainingText.classList.remove('hidden');
                    completeText.classList.add('hidden');
                    daysElapsedText.textContent = `${daysElapsed} days elapsed`;
                    daysRemainingText.textContent = `${daysRemaining} days remaining`;
                }

                progressStartDate.textContent = dateFormatter.format(startDate);
                progressEndDate.textContent = dateFormatter.format(finishDate);
            }

            function updateProgress() {
                const progressBar = document.getElementById('progress-bar');
                // Calculate progress percentage (33.33% per completed experiment)
                const progressPercent = ((currentExperiment - 1) / EXPERIMENTS_PER_SESSION) * 100;
                progressBar.style.width = `${progressPercent}%`;
                document.getElementById('current-experiment').textContent = currentExperiment;
            }

            async function loadChallenge() {
                console.log('Loading challenge for experiment:', currentExperiment, 'of', EXPERIMENTS_PER_SESSION);
                // Check if we've completed all experiments
                if (currentExperiment > EXPERIMENTS_PER_SESSION) {
                    console.log('All experiments completed, showing modal');
                    showCompletionModal();
                    return;
                }

                const experimentContainer = document.getElementById('challenge-container');
                experimentContainer.classList.add('fade-out');

                // Wait for fade out animation
                await new Promise(resolve => setTimeout(resolve, 500));

                showLoading('loading-overlay');
                resetDecisions();
                updateProgress();

                try {
                    if (typeof generateABTestChallenge !== 'function') {
                        console.error("Challenge generator not found");
                        alert("Error: Challenge generator not found");
                        return;
                    }

                    challenge = generateABTestChallenge();
                    const formatPercentage = (value) => {
                        const percentage = value * 100;
                        return Number.isInteger(percentage) ? `${percentage}%` : `${percentage.toFixed(1)}%`;
                    };

                    document.getElementById('exp-alpha').textContent = formatPercentage(challenge.experiment.alpha);
                    document.getElementById('exp-beta').textContent = formatPercentage(1 - challenge.experiment.beta);
                    document.getElementById('exp-base-rate').textContent = `${(challenge.experiment.baseConversionRate * 100).toFixed(2)}%`;
                    document.getElementById('exp-min-effect').textContent = `${(challenge.experiment.minimumRelevantEffect * 100).toFixed(2)}%`;
                    document.getElementById('exp-visitors').textContent = challenge.experiment.visitorsPerDay.toLocaleString();
                    document.getElementById('exp-required-sample').textContent = challenge.experiment.requiredSampleSizePerVariant.toLocaleString();
                    document.getElementById('exp-cycle-days').textContent = challenge.experiment.businessCycleDays === 1 ? '1 day' : '1 week';
                    document.getElementById('exp-required-days').textContent = `${challenge.experiment.requiredRuntimeDays} days`;


                    document.getElementById('base-visitors').textContent = challenge.simulation.actualVisitorsBase;
                    document.getElementById('base-conversions').textContent = challenge.simulation.actualConversionsBase;
                    document.getElementById('base-rate').textContent = `${(challenge.simulation.actualBaseConversionRate * 100).toFixed(2)}%`;

                    document.getElementById('variant-visitors').textContent = challenge.simulation.actualVisitorsVariant;
                    document.getElementById('variant-conversions').textContent = challenge.simulation.actualConversionsVariant;
                    document.getElementById('variant-rate').textContent = `${(challenge.simulation.variantConversionRate * 100).toFixed(2)}%`;

                    const formatDelta = (value, isPercentage = false) => {
                        const sign = value > 0 ? '+' : '';
                        return isPercentage ?
                            `${sign}${(value * 100).toFixed(2)}%` :
                            `${sign}${value}`;
                    };

                    document.getElementById('delta-visitors').textContent = formatDelta(challenge.simulation.actualVisitorsVariant - challenge.simulation.actualVisitorsBase);
                    document.getElementById('delta-conversions').textContent = formatDelta(challenge.simulation.actualConversionsVariant - challenge.simulation.actualConversionsBase);
                    document.getElementById('delta-rate').textContent = formatDelta(challenge.simulation.variantConversionRate - challenge.simulation.actualBaseConversionRate, true);

                    const formatUplift = (value) => {
                        const sign = value > 0 ? '+' : '';
                        return `${sign}${(value * 100).toFixed(2)}%`;
                    };

                    document.getElementById('visitor-uplift').textContent = formatUplift(challenge.simulation.visitorUplift);
                    document.getElementById('conversion-uplift').textContent = formatUplift(challenge.simulation.conversionUplift);
                    document.getElementById('uplift-value').textContent = formatUplift(challenge.simulation.uplift);

                    updateExecutionSection(challenge)

                    showLoading('chart-loading');

                    setTimeout(() => {
                        hideLoading('chart-loading');
                        initializeCharts(challenge);

                        // Fade in the new experiment
                        experimentContainer.classList.remove('fade-out');
                        experimentContainer.classList.add('fade-in');
                        // Initialize cheat sheet right after showing the challenge
                        initializeCheatSheet();
                    }, 500);

                } catch (error) {
                    console.error('Error loading challenge:', error);
                    alert('Error loading challenge');
                } finally {
                    hideLoading('loading-overlay');
                }
            }

            function showCompletionModal() {
                console.log('Showing completion modal');
                const experimentContainer = document.getElementById('challenge-container');
                const completionModal = document.getElementById('completion-modal');

                // Fade out experiment container
                experimentContainer.classList.add('fade-out');

                setTimeout(() => {
                    experimentContainer.classList.add('hidden');
                    document.getElementById('final-score').textContent = score;
                    document.getElementById('final-accuracy').textContent = `${Math.round((score / totalAttempts) * 100)}%`;

                    // Show and fade in completion modal
                    completionModal.classList.remove('hidden');
                    setTimeout(() => {
                        completionModal.classList.add('fade-in');
                    }, 10);
                }, 500);
            }

            async function evaluateDecision(userChoice) {
                console.log('Evaluating decision for experiment:', currentExperiment);
                if (!challenge) {
                    console.error("No challenge loaded");
                    alert("No challenge available. Try reloading.");
                    return;
                }

                showLoading('loading-overlay');

                try {
                    totalAttempts++;
                    const correctDecision = challenge.simulation.variantConversionRate > challenge.simulation.actualBaseConversionRate;

                    if (userChoice === correctDecision) {
                        score++;
                        streak++;
                        document.getElementById('feedback-icon').className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100';
                        document.getElementById('feedback-icon').innerHTML = '<svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
                        document.getElementById('feedback-title').textContent = 'Correct!';
                        document.getElementById('feedback-title').className = 'text-lg leading-6 font-medium text-green-900 mt-4';
                    } else {
                        streak = 0;
                        document.getElementById('feedback-icon').className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100';
                        document.getElementById('feedback-icon').innerHTML = '<svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
                        document.getElementById('feedback-title').textContent = 'Incorrect';
                        document.getElementById('feedback-title').className = 'text-lg leading-6 font-medium text-red-900 mt-4';
                    }

                    const accuracy = Math.round((score / totalAttempts) * 100);
                    document.getElementById('score').textContent = score;
                    document.getElementById('streak').textContent = streak;
                    document.getElementById('accuracy').textContent = `${accuracy}%`;

                    document.getElementById('modal-score').textContent = score;
                    document.getElementById('modal-streak').textContent = streak;
                    document.getElementById('modal-accuracy').textContent = `${accuracy}%`;

                    // Check if this was the last experiment of the session
                    console.log('Checking if last experiment:', currentExperiment, 'of', EXPERIMENTS_PER_SESSION);
                    if (currentExperiment === EXPERIMENTS_PER_SESSION) {
                        document.getElementById('next-challenge-btn').textContent = 'Done!';
                    }

                } finally {
                    hideLoading('loading-overlay');
                    document.getElementById('feedback-modal').classList.remove('hidden');
                }
            }

            document.getElementById('start-btn').addEventListener('click', function(event) {
                event.preventDefault();
                console.log('Start button clicked');

                // Fade out tutorial section
                const tutorialSection = document.getElementById('tutorial-section');
                tutorialSection.classList.add('fade-out');

                // Wait for fade out animation
                setTimeout(() => {
                    tutorialSection.classList.add('hidden');
                    document.getElementById('challenge-container').classList.remove('hidden');
                    document.getElementById('challenge-container').classList.add('fade-in');
                    loadChallenge();
                }, 500);
            });


            function checkDecisions() {
                const submitBtn = document.getElementById('submit-decision');
                if (trustDecision !== null && implementDecision !== null) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    submitBtn.disabled = true;
                    submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }

            function handleDecision(decisionType, value) {
                const trustButtons = [document.getElementById('trust-yes'), document.getElementById('trust-no')];
                const implementButtons = [document.getElementById('implement-yes'), document.getElementById('implement-no')];

                if (decisionType === 'trust') {
                    trustDecision = value;
                    trustButtons.forEach(btn => {
                        btn.classList.remove('bg-green-700', 'bg-red-700');
                        btn.disabled = false;
                    });
                    if (value) {
                        document.getElementById('trust-yes').classList.add('bg-green-700');
                    } else {
                        document.getElementById('trust-no').classList.add('bg-red-700');
                    }
                } else if (decisionType === 'implement') {
                    implementDecision = value;
                    implementButtons.forEach(btn => {
                        btn.classList.remove('bg-green-700', 'bg-red-700');
                        btn.disabled = false;
                    });
                    if (value) {
                        document.getElementById('implement-yes').classList.add('bg-green-700');
                    } else {
                        document.getElementById('implement-no').classList.add('bg-red-700');
                    }
                }

                checkDecisions();
            }

            function resetDecisions() {
                console.log('Resetting decisions');
                trustDecision = null;
                implementDecision = null;
                const buttons = ['trust-yes', 'trust-no', 'implement-yes', 'implement-no'];
                buttons.forEach(id => {
                    const btn = document.getElementById(id);
                    btn.classList.remove('bg-green-700', 'bg-red-700');
                    btn.disabled = false;
                });
                checkDecisions();
            }

            document.getElementById('trust-yes').addEventListener('click', () => handleDecision('trust', true));
            document.getElementById('trust-no').addEventListener('click', () => handleDecision('trust', false));
            document.getElementById('implement-yes').addEventListener('click', () => handleDecision('implement', true));
            document.getElementById('implement-no').addEventListener('click', () => handleDecision('implement', false));

            document.getElementById('submit-decision').addEventListener('click', function() {
                console.log('Decision submitted for experiment:', currentExperiment);
                submitDecision(); // Call the new submitDecision function
            });

            document.getElementById('next-challenge-btn').addEventListener('click', async function() {
                const feedbackModal = document.getElementById('feedback-modal');
                feedbackModal.classList.add('fade-out');

                // Wait for fade out animation
                await new Promise(resolve => setTimeout(resolve, 500));
                feedbackModal.classList.add('hidden');
                feedbackModal.classList.remove('fade-out');

                // First increment the counter
                currentExperiment++;
                console.log('Incremented to experiment:', currentExperiment);

                // Then check if we should show completion
                if (currentExperiment > EXPERIMENTS_PER_SESSION) {
                    console.log('Session complete, showing completion modal');
                    const completionModal = document.getElementById('completion-modal');
                    completionModal.classList.remove('hidden');
                    setTimeout(() => {
                        completionModal.classList.add('fade-in');
                    }, 10);
                    showCompletionModal();
                } else {
                    console.log('Loading next experiment:', currentExperiment);
                    resetDecisions();
                    updateProgress();
                    loadChallenge();
                }
            });

            document.getElementById('start-new-session').addEventListener('click', function() {
                console.log('Starting new session');
                const completionModal = document.getElementById('completion-modal');
                const experimentContainer = document.getElementById('challenge-container');

                // Hide the completion modal
                completionModal.classList.add('hidden');

                // Show experiment container
                experimentContainer.classList.remove('hidden');

                // Reset session variables
                currentExperiment = 1;
                score = 0;
                streak = 0;
                totalAttempts = 0;

                // Update displays
                document.getElementById('current-experiment').textContent = currentExperiment;
                document.getElementById('score').textContent = score;
                document.getElementById('streak').textContent = streak;
                document.getElementById('accuracy').textContent = '0%';

                // Reset the button text to "Next Challenge"
                const nextButton = document.getElementById('next-challenge-btn');
                if (nextButton) {
                    nextButton.textContent = 'Next!';
                }

                // Start new challenge
                loadChallenge();
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active state from all tabs
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('border-blue-500', 'text-blue-600');
                        btn.classList.add('text-gray-500');
                    });

                    // Add active state to clicked tab
                    button.classList.add('border-blue-500', 'text-blue-600');
                    button.classList.remove('text-gray-500');

                    // Hide all tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });

                    // Show selected tab content
                    const tabName = button.getAttribute('data-tab');
                    document.getElementById(`${tabName}-tab`).classList.remove('hidden');
                });
            });

            function showLoading(id) {
                console.log('Showing loading indicator:', id);
                document.getElementById(id).classList.remove('hidden');
            }

            function hideLoading(id) {
                console.log('Hiding loading indicator:', id);
                document.getElementById(id).classList.add('hidden');
            }

            function shareOnTwitter() {
                const text = `I just completed the A/B Testing Gym challenge with a score of ${score} and ${Math.round((score / totalAttempts) * 100)}% accuracy! Try it yourself!`;
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`);
            }

            function shareOnLinkedIn() {
                const text = `I just completed the A/B Testing Gym challenge with a score of ${score} and ${Math.round((score / totalAttempts) * 100)}% accuracy! Try it yourself!`;
                window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}&summary=${encodeURIComponent(text)}`);
            }

            function updateProgressBar() {
                const progressBar = document.getElementById('progress-bar');
                const progressPercentage = (currentExperiment / EXPERIMENTS_PER_SESSION) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                document.getElementById('current-experiment').textContent = currentExperiment;
                document.querySelector('#current-experiment').parentElement.parentElement.querySelector('.text-sm.font-medium.text-gray-700:nth-child(2)').textContent = `Experiment ${currentExperiment}/${EXPERIMENTS_PER_SESSION}`;

            }

            // Move cheat sheet event listeners to the top level scope
            function initializeCheatSheet() {
                console.log('Initializing cheat sheet...');
                const cheatSheetBtn = document.getElementById('cheat-sheet-btn');
                const cheatSheetModal = document.getElementById('cheat-sheet-modal');
                const closeCheatSheet = document.getElementById('close-cheat-sheet');

                if (!cheatSheetBtn || !cheatSheetModal || !closeCheatSheet) {
                    console.error('Cheat sheet elements not found:', {
                        button: !!cheatSheetBtn,
                        modal: !!cheatSheetModal,
                        closeBtn: !!closeCheatSheet
                    });
                    return;
                }

                cheatSheetBtn.addEventListener('click', function() {
                    console.log('Cheat sheet button clicked');
                    cheatSheetModal.classList.remove('hidden');
                });

                closeCheatSheet.addEventListener('click', function() {
                    console.log('Close button clicked');
                    cheatSheetModal.classList.add('hidden');
                });

                // Close modal when clicking outside
                cheatSheetModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            }

            function toggleSection(sectionId) {
                console.log('Toggling section:', sectionId);
                const section = document.getElementById(sectionId);
                const arrow = document.getElementById(sectionId.replace('details', 'arrow'));

                if (section && arrow) {
                    section.classList.toggle('hidden');
                    arrow.classList.toggle('rotate-180');
                }
            }

            async function submitDecision() {
                    if (trustDecision === null || implementDecision === null) {
                        return;
                    }

                    showLoading('loading-overlay');

                    try {
                        totalAttempts++;
                        const isCorrectTrust = challenge.simulation.timeline.currentRuntimeDays >= challenge.experiment.requiredRuntimeDays;
                        const isCorrectImplement = challenge.simulation.uplift > 0 && challenge.simulation.pValue < challenge.experiment.alpha;

                        const isCorrect = (trustDecision === isCorrectTrust) && (implementDecision === isCorrectImplement);

                        if (isCorrect) {
                            score += (10 * currentExperiment);  // More points for later experiments
                            streak++;
                        } else {
                            streak = 0;
                        }

                        // Update score display immediately
                        document.getElementById('score').textContent = score;
                        document.getElementById('streak').textContent = streak;
                        document.getElementById('accuracy').textContent = `${((score / (totalAttempts * 10)) * 100).toFixed(1)}%`;

                        // Update modal scores
                        document.getElementById('modal-score').textContent = score;
                        document.getElementById('modal-streak').textContent = streak;
                        document.getElementById('modal-accuracy').textContent = `${((score / (totalAttempts * 10)) * 100).toFixed(1)}%`;

                        // Update feedback
                        const feedback = document.getElementById('feedback-message');
                        const feedbackTitle = document.getElementById('feedback-title');
                        const feedbackIcon = document.getElementById('feedback-icon');

                        if (isCorrect) {
                            feedbackTitle.textContent = 'Correct!';
                            feedbackIcon.innerHTML = '<svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
                            feedbackIcon.classList.remove('bg-red-100');
                            feedbackIcon.classList.add('bg-green-100');
                            feedback.textContent = `Great job! You correctly identified ${isCorrectTrust ? 'that the experiment was ready' : 'that more data was needed'} and made the right implementation decision.`;
                        } else {
                            feedbackTitle.textContent = 'Not Quite Right';
                            feedbackIcon.innerHTML = '<svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
                            feedbackIcon.classList.remove('bg-green-100');
                            feedbackIcon.classList.add('bg-red-100');
                            feedback.textContent = `Keep practicing! The experiment ${isCorrectTrust ? 'was ready' : 'needed more data'} and the variant ${isCorrectImplement ? 'should' : 'should not'} have been implemented.`;
                        }

                    } finally {
                        hideLoading('loading-overlay');
                        document.getElementById('feedback-modal').classList.remove('hidden');
                    }
                }

        </script>
    </body>
</html>